<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Board Objective Test 01</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* New Color Palette & Fonts */
        :root {
            /* Dark Mode Defaults */
            --bg-primary: #1A202C; /* Deep Charcoal Blue */
            --bg-secondary: #2D3748; /* Slate Gray */
            --accent-blue: #4CC9F0; /* Vibrant Sky Blue */
            --accent-purple: #8D5BFC; /* Electric Purple */
            --success: #2ECC71; /* Emerald Green */
            --danger: #E74C3C; /* Fiery Red */
            --text-light: #E2E8F0; /* Light Gray */
            --text-muted: #A0AEC0; /* Medium Gray */
            --border-color: #4A5568; /* Darker border for elements */
            --shadow-light: rgba(0, 0, 0, 0.3);
            --shadow-dark: rgba(0, 0, 0, 0.6);

            /* Theme for Navbar */
            --navbar-bg-start: var(--accent-blue);
            --navbar-bg-end: var(--accent-purple);
            --navbar-text-color: white;
            --navbar-timer-bg: rgba(255,255,255,0.1);
            --navbar-timer-border: rgba(255,255,255,0.3);
            --navbar-button-bg: rgba(255,255,255,0.2); /* Old dark mode button styling */
            --navbar-button-color: white; /* Old dark mode button styling */
            --navbar-button-hover-bg: rgba(255,255,255,0.3); /* Old dark mode button styling */
        }

        body.light-mode {
            --bg-primary: #F0F2F5; /* Very Light Gray */
            --bg-secondary: #FFFFFF; /* Pure White */
            --accent-blue: #007BFF; /* Bootstrap Primary Blue */
            --accent-purple: #6610F2; /* Darker Purple */
            --success: #28A745; /* Green */
            --danger: #DC3545; /* Red */
            --text-light: #343A40; /* Dark Gray for Text */
            --text-muted: #6C757D; /* Medium Gray for Muted Text */
            --border-color: #E9ECEF; /* Light Border */
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-dark: rgba(0, 0, 0, 0.15);

            /* Theme for Navbar in Light Mode */
            --navbar-bg-start: var(--accent-blue);
            --navbar-bg-end: var(--accent-purple);
            --navbar-text-color: white;
            --navbar-timer-bg: rgba(0,0,0,0.1);
            --navbar-timer-border: rgba(0,0,0,0.3);
            --navbar-button-bg: white; /* Old dark mode button styling */
            --navbar-button-color: var(--accent-blue); /* Old dark mode button styling */
            --navbar-button-hover-bg: #e2e6ea; /* Old dark mode button styling */
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-light);
            margin: 0;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.4s ease, color 0.4s ease;
        }
        /* Ensure elements adapt to theme changes */
        .navbar, /* Changed from .quiz-topbar */
        .question-nav-panel,
        .quiz-question-area,
        .option-card,
        .integer-input-box input,
        .stat-card,
        .section-analysis th,
        .section-analysis td,
        .question-lists ul {
            transition: background-color 0.4s ease, color 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease;
        }
        /* Button colors need to adapt */
        .btn-submit-quiz {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            color: white;
        }
        .btn-submit-quiz:hover {
            opacity: 0.9;
        }
        .btn-mark-review-next {
            background-color: var(--accent-purple);
        }
        .btn-clear-response,
        .btn-retake {
            background-color: var(--danger);
        }
        .review-nav-buttons .btn {
            background-color: var(--bg-secondary);
            color: var(--accent-blue);
            border-color: var(--accent-blue);
        }
        /* Specific state colors for nav buttons */
        .nav-buttons-grid button {
            background-color: var(--border-color);
            color: var(--text-light);
            border-color: var(--border-color);
        }
        .nav-buttons-grid button.current {
            background-color: var(--accent-blue) !important;
            color: var(--bg-primary) !important;
            border-color: var(--accent-blue) !important;
        }
        .nav-buttons-grid button.attempted {
            background-color: var(--success) !important;
            color: white !important;
            border-color: var(--success) !important;
        }
        .nav-buttons-grid button.marked-review {
            background-color: var(--accent-purple) !important;
            color: white !important;
            border-color: var(--accent-purple) !important;
        }
        .nav-buttons-grid button.skipped {
            background-color: var(--text-muted) !important; /* Grey for skipped */
            color: white !important;
            border-color: var(--text-muted) !important;
        }
        .nav-buttons-grid button.correct-answered {
            background-color: var(--success) !important;
            color: white !important;
            border-color: var(--success) !important;
        }
        .nav-buttons-grid button.incorrect-answered {
            background-color: var(--danger) !important;
            color: white !important;
            border-color: var(--danger) !important;
        }
        
        /* Navbar / Top Bar - New Styles based on snippet */
        .navbar {
            background: linear-gradient(135deg, var(--navbar-bg-start), var(--navbar-bg-end)) !important;
            box-shadow: 0 4px 20px var(--shadow-dark);
            padding: 0.5rem 1rem; /* Adjusted for smaller height */
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }
        .navbar-brand {
            font-family: 'Poppins', sans-serif;
            font-weight: 800; /* Original snippet uses fw-bold, but Poppins 800 looks better */
            font-size: 1.5rem; /* Adjusted from 1.8rem for compactness */
            color: var(--navbar-text-color);
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.4); /* Example from old title */
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            margin-right: auto; /* Push content to right */
        }
        .navbar-brand i {
            margin-right: 8px;
            font-size: 1.2em; /* Adjusted icon size */
        }

        .timer-display {
            background-color: var(--navbar-timer-bg);
            color: var(--navbar-text-color);
            border: 1px solid var(--navbar-timer-border);
            border-radius: 30px;
            padding: 0.4rem 1rem; /* Adjusted padding */
            font-size: 0.9rem; /* Adjusted font size */
            font-weight: 600;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            flex-shrink: 0;
            white-space: nowrap; /* Prevent timer text from wrapping */
        }
        .timer-display i {
            margin-right: 6px;
        }
        .timer-display:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .navbar-buttons { /* Custom class for the buttons group */
            display: flex;
            gap: 10px;
            flex-shrink: 0;
            margin-left: 15px; /* Space between timer and buttons */
        }
        .navbar-buttons .btn {
            padding: 0.5rem 1.2rem;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px var(--shadow-light);
            border: none;
        }
        /* Specific styling for the submit button in the navbar */
        .navbar-buttons .btn-submit-quiz-navbar {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            color: white;
        }
        .navbar-buttons .btn-submit-quiz-navbar:hover {
            opacity: 0.9;
        }

        /* Dark Mode Toggle Button - NEW STYLES */
        #theme-toggle-btn {
            position: fixed; /* Page ke relative fixed position */
            bottom: 20px;    /* Bottom se 20px upar */
            right: 20px;     /* Right se 20px andar */
            width: 55px;     /* Button ki चौड़ाई (width) */
            height: 55px;    /* Button ki ऊँचाई (height) */
            border-radius: 50%; /* Isse button circular banega */
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); /* Gradient background */
            color: white;    /* Text/Icon color */
            border: none;    /* Border remove karein */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Thoda shadow add karein */
            display: flex;   /* Icon/text ko center karne ke liye */
            justify-content: center; /* Horizontally center */
            align-items: center;     /* Vertically center */
            cursor: pointer; /* Pointer cursor on hover */
            font-size: 24px; /* Icon size */
            z-index: 10000;   /* Ensure it stays on top of other content, even modal */
            transition: all 0.3s ease; /* Smooth transitions */
        }
        /* Hover effect */
        #theme-toggle-btn:hover {
            transform: scale(1.1); /* Thoda bada karein hover par */
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }
        /* Light mode specific styling for the toggle button */
        body.light-mode #theme-toggle-btn {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue)); /* Reverse gradient or different color in light mode */
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        body.light-mode #theme-toggle-btn:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        /* Main Content Wrapper - Changed for right-aligned sidebar */
        .main-wrapper {
            display: flex;
            flex-grow: 1; /* Allow it to fill remaining vertical space */
            padding: 20px;
            gap: 20px;
            align-items: flex-start; /* Align content to top */
            flex-wrap: nowrap; /* Prevent wrapping by default on desktop */
            justify-content: center; /* Center the two main blocks */
        }
        /* Max width for the entire main wrapper to keep it contained on very wide screens */
        @media (min-width: 1200px) {
            .main-wrapper {
                max-width: 1400px; /* Adjust as needed */
                margin: 0 auto; /* Center the wrapper */
            }
        }

        /* Quiz Question Area - Takes most of the space */
        .quiz-question-area {
            flex-grow: 1; /* Take up remaining space */
            background-color: var(--bg-secondary);
            border-radius: 15px;
            padding: 30px 40px;
            box-shadow: 0 8px 30px var(--shadow-dark);
            overflow-y: auto;
            border: 1px solid var(--border-color);
            min-height: calc(100vh - 120px); /* Adjust based on topbar height */
            order: 1; /* Ensure it comes first on desktop */
            /* Set a max-width to keep it from stretching too wide on very large screens relative to sidebar */
            /* This makes sure quiz area takes most of the space but respects sidebar */
            max-width: calc(100% - 350px - 20px); /* 100% - sidebar_width - gap */
        }

        .question-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .question-number {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-blue);
        }
        .subject-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .subject-tag {
            background-color: var(--accent-purple);
            color: white;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .mark-pill {
            font-size: 0.85rem;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .mark-pill.plus { background-color: rgba(46, 204, 113, 0.2); color: var(--success); }
        .mark-pill.minus { background-color: rgba(231, 76, 60, 0.2); color: var(--danger); }

        .question-image-container {
            margin-bottom: 30px;
            text-align: center;
            background-color: var(--bg-primary);
            padding: 20px;
            border-radius: 10px;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.4);
        }
        .question-image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            transition: transform 0.3s ease;
        }
        .question-image-container img:hover {
            transform: scale(1.01);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .option-card {
            background-color: var(--bg-primary);
            border: 2px solid var(--border-color);
            padding: 20px 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            font-weight: 500;
            color: var(--text-light);
            user-select: none;
            box-shadow: 0 4px 15px var(--shadow-light);
        }
        .option-card:hover {
            transform: translateY(-5px) scale(1.01);
            border-color: var(--accent-blue);
            background-color: rgba(76, 201, 240, 0.08);
            box-shadow: 0 8px 25px rgba(76, 201, 240, 0.2);
        }

        .option-prefix {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: var(--border-color);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            margin-right: 15px;
            flex-shrink: 0;
            transition: background-color 0.2s ease;
        }

        .option-card.selected {
            border-color: var(--accent-blue);
            background-color: rgba(76, 201, 240, 0.15);
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.3);
        }
        .option-card.selected .option-prefix {
            background-color: var(--accent-blue);
            color: var(--bg-primary);
        }

        .option-card.correct {
            border-color: var(--success) !important;
            background-color: rgba(46, 204, 113, 0.25) !important;
            color: white !important;
            cursor: default;
        }
        .option-card.correct .option-prefix {
            background-color: var(--success);
            color: white;
        }

        .option-card.incorrect {
            border-color: var(--danger) !important;
            background-color: rgba(231, 76, 60, 0.25) !important;
            color: white !important;
            cursor: default;
        }
        .option-card.incorrect .option-prefix {
            background-color: var(--danger);
            color: white;
        }

        /* Integer Input Style */
        .integer-input-box label {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 10px;
            display: block;
        }
        .integer-input-box input {
            background-color: var(--bg-primary);
            border: 2px solid var(--border-color);
            color: var(--text-light);
            padding: 12px 18px;
            border-radius: 8px;
            width: 200px;
            font-size: 1.1rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .integer-input-box input:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.3);
            background-color: var(--bg-secondary);
        }
        .integer-review-box p {
            margin-bottom: 5px;
            font-size: 1rem;
            color: var(--text-muted);
        }
        .integer-review-box strong {
            color: var(--accent-blue);
        }
        .integer-review-box .user-answer {
            font-weight: 600;
            color: var(--text-light);
        }
        .integer-review-box .user-answer.correct-answer {
            color: var(--success);
        }
        .integer-review-box .user-answer.incorrect-answer {
            color: var(--danger);
        }

        /* Controls */
        .question-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            padding-top: 20px;
            border-top: 1px dashed var(--border-color);
            margin-top: 40px;
        }
        .question-controls .btn {
            padding: 12px 28px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1rem;
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: all 0.3s ease;
            color: white;
            border: none;
        }
        .question-controls .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px var(--shadow-dark);
        }

        .btn-clear-response { background-color: var(--danger); }
        .btn-clear-response:hover { background-color: #d63a62; }

        .btn-secondary { /* Default for skip button */
            background-color: var(--text-muted);
            color: white;
        }
        .btn-secondary:hover {
            background-color: #8899a6;
            color: white;
        }

        .btn-save-next { background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); }
        .btn-save-next:hover { opacity: 0.9; }

        .btn-mark-review-next { background-color: var(--accent-purple); }
        .btn-mark-review-next:hover { background-color: #7a46d1; }

        .review-nav-buttons .btn {
            background-color: var(--bg-secondary);
            color: var(--accent-blue);
            border: 1px solid var(--accent-blue);
        }
        .review-nav-buttons .btn:hover {
            background-color: var(--accent-blue);
            color: var(--bg-primary);
        }
        .review-nav-buttons .btn-back-to-result {
            background: linear-gradient(90deg, #F5A623, #FFD700); /* Warm yellow/orange */
            color: var(--bg-primary);
            border: none;
        }
        .review-nav-buttons .btn-back-to-result:hover {
             background: linear-gradient(90deg, #E09520, #E0C100);
        }

        /* Question Navigation Panel (Right Sidebar) */
        .question-nav-panel {
            width: 350px; /* Fixed width for desktop */
            min-width: 280px; /* Ensure it's not too small */
            flex-shrink: 0; /* Prevent it from shrinking */
            background-color: var(--bg-secondary);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 30px var(--shadow-dark);
            overflow-y: auto;
            border: 1px solid var(--border-color);
            display: flex; /* Default to flex on desktop */
            flex-direction: column;
            gap: 20px;
            min-height: calc(100vh - 120px);
            order: 2; /* Ensure it comes second on desktop */
            transition: all 0.3s ease;
        }
        
        .panel-heading {
            font-family: 'Poppins', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 15px;
            text-align: center;
        }
        .panel-section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-light);
            cursor: pointer;
            padding: 10px 15px;
            background-color: var(--bg-primary);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
            margin-bottom: 10px; /* Space between title and grid */
        }
        .panel-section-title:hover {
            background-color: var(--border-color);
        }
        .panel-section-title i {
            transition: transform 0.2s ease;
        }
        .panel-section-title i.fa-chevron-up {
            transform: rotate(180deg);
        }

        /* Hide question numbers grid by default */
        .nav-buttons-grid {
            display: none; /* Hidden by default */
            grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
            gap: 10px;
            padding-top: 10px;
            padding-bottom: 20px;
            border-bottom: 1px dashed var(--border-color);
        }
        .nav-buttons-grid.d-block { /* Show when active (toggled by JS) */
            display: grid !important; /* Force display grid */
        }
        .nav-buttons-grid:last-of-type {
             border-bottom: none;
        }

        .nav-buttons-grid button {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background-color: var(--border-color);
            color: var(--text-light);
            font-weight: 600;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px var(--shadow-light);
        }
        .nav-buttons-grid button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 4px 12px var(--shadow-dark);
        }
        .nav-buttons-grid button.current {
            background-color: var(--accent-blue) !important;
            color: var(--bg-primary) !important;
            border-color: var(--accent-blue) !important;
        }
        .nav-buttons-grid button.attempted {
            background-color: var(--success) !important;
            color: white !important;
            border-color: var(--success) !important;
        }
        .nav-buttons-grid button.marked-review {
            background-color: var(--accent-purple) !important;
            color: white !important;
            border-color: var(--accent-purple) !important;
        }
        /* Specific states for review mode */
        .nav-buttons-grid button.correct-answered {
            background-color: var(--success) !important;
            color: white !important;
        }
        .nav-buttons-grid button.incorrect-answered {
            background-color: var(--danger) !important;
            color: white !important;
        }
        .nav-buttons-grid button.skipped {
            background-color: var(--text-muted) !important;
            color: white !important;
            border-color: var(--text-muted) !important;
        }


        /* Result Page Full Screen */
        body.show-result .navbar, /* Changed from .quiz-topbar */
        body.show-result .question-nav-panel,
        body.show-result #toggle-nav-btn,
        body.show-result #theme-toggle-btn { /* Hide dark mode button in result mode */
            display: none !important;
        }
        body.show-result .main-wrapper { /* Changed from .main-quiz-content */
            justify-content: center; /* Center result content */
            padding-top: 20px; /* Add some padding from top if navbar is hidden */
        }
        body.show-result .quiz-question-area {
            max-width: 900px;
            margin: 0 auto; /* Center it within the main-wrapper */
            border-radius: 20px;
            padding: 50px;
            min-height: auto; /* Allow height to adjust to content */
            order: initial; /* Reset order to allow centering */
        }
        .result-content-wrapper h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--accent-blue);
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 15px rgba(76, 201, 240, 0.4);
            letter-spacing: 1px;
        }
        .result-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 25px;
            margin-top: 30px;
            margin-bottom: 40px;
            justify-content: center;
        }
        .stat-card {
            background-color: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 6px 20px var(--shadow-dark);
            transition: transform 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
        }
        .stat-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        .stat-card-value {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--accent-blue);
        }
        .stat-card.correct .stat-card-value { color: var(--success); }
        .stat-card.incorrect .stat-card-value { color: var(--danger); }
        .stat-card.score .stat-card-value { color: var(--accent-purple); }

        .section-analysis table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 12px;
            margin-top: 30px;
            font-size: 1rem;
        }
        .section-analysis th, .section-analysis td {
            padding: 15px;
            text-align: center;
            border: none;
            background-color: var(--bg-primary);
            color: var(--text-light);
            border-radius: 10px;
        }
        .section-analysis th {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            color: white;
            font-weight: 700;
            text-transform: uppercase;
        }
        .section-analysis tbody tr {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .section-analysis tbody tr:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px var(--shadow-dark);
        }

        .result-action-buttons {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 50px;
            flex-wrap: wrap;
        }
        .result-action-buttons .btn {
            padding: 15px 35px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 50px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            transition: all 0.3s ease;
            color: white;
            border: none;
        }
        .result-action-buttons .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
        }
        .btn-analyse {
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue));
        }
        .btn-retake {
            background: linear-gradient(90deg, var(--success), #219d5c);
        }

        .question-lists h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            color: var(--accent-blue);
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }
        .question-lists ul {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
            background-color: var(--bg-primary);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            padding: 20px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }
        /* Enhanced styling for question list items in result */
        .question-lists li {
            display: flex; /* Use flexbox for alignment */
            justify-content: space-between; /* Space out content and button */
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px dashed var(--border-color);
            font-size: 1rem;
            color: var(--text-light);
            transition: background-color 0.2s ease;
        }
        .question-lists li:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        .question-lists li:last-child {
            border-bottom: none;
        }
        .question-lists li .list-item-content {
            display: flex;
            align-items: center;
            flex-grow: 1; /* Allow content to take available space */
            margin-right: 15px; /* Space between content and button */
        }
        .question-lists li .icon {
            margin-right: 12px;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        .question-lists li.correct-item .icon { color: var(--success); }
        .question-lists li.incorrect-item .icon { color: var(--danger); }
        .question-lists li.unattempted-item .icon { color: var(--text-muted); }
        .question-lists li strong {
            color: var(--accent-blue);
        }
        /* Style for the new View Now button */
        .btn-view-now {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s ease;
            white-space: nowrap; /* Prevent text wrapping */
            flex-shrink: 0; /* Prevent button from shrinking */
        }
        .btn-view-now:hover {
            background-color: var(--accent-purple);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .btn-view-now i {
            margin-left: 5px;
        }

        /* Review Mode Styling */
        body.show-review .navbar { /* Changed from .quiz-topbar */
            display: none !important;
        }
        body.show-review #back-to-result-btn {
            display: block; /* Show back button in review */
        }
        body.show-review #theme-toggle-btn { /* Hide dark mode button in review mode */
            display: none !important;
        }
        body.show-review .question-nav-panel {
            display: flex !important; /* Show nav panel in review */
            width: 350px; /* Ensure it's full width in review */
            margin-right: 0; /* Reset margin */
            opacity: 1; /* Ensure opacity is 1 */
        }
        body.show-review .quiz-question-area {
            min-height: calc(100vh - 40px); /* Adjust for back button */
        }

        #back-to-result-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: none; /* Hidden by default */
            background: linear-gradient(90deg, #F5A623, #FFD700); /* Warm yellow/orange */
            color: var(--bg-primary);
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(245, 166, 35, 0.4);
            transition: all 0.3s ease;
        }
        #back-to-result-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(245, 166, 35, 0.6);
        }

        /* Responsive Design */
        @media (max-width: 991px) { /* Changed from 992px to 991px for Bootstrap's common breakpoint */
            .main-wrapper { /* Changed from .main-quiz-content */
                flex-direction: column;
                align-items: center;
                padding: 15px; /* Slightly less padding on smaller screens */
                gap: 15px;
                flex-wrap: wrap; /* Allow wrapping on small screens */
            }
            .question-nav-panel {
                width: 100%;
                margin-top: 15px;
                min-height: auto;
                order: 2; /* Move it below the main quiz area on small screens */
            }
            .quiz-question-area {
                width: 100%;
                padding: 20px; /* Adjusted padding */
                min-height: auto;
                order: 1; /* Keep main quiz area first */
                max-width: 100%; /* Ensure full width on small screens */
            }
            .navbar { /* Changed from .quiz-topbar */
                padding: 0.8rem 1.2rem; /* Reduced padding */
                justify-content: center;
            }
            .navbar-brand {
                font-size: 1.5rem;
                margin-right: 0; /* Remove auto-margin on mobile */
                width: 100%; /* Full width for brand on small screens */
                text-align: center;
                margin-bottom: 10px; /* Space below brand */
            }
            .navbar-buttons {
                width: 100%;
                justify-content: center;
                margin-left: 0;
            }
            .timer-display {
                font-size: 0.9rem;
                padding: 0.4rem 1rem;
            }
            .navbar-buttons .btn {
                padding: 0.5rem 1.2rem;
                font-size: 0.9rem;
            }
            .question-number {
                font-size: 1.5rem;
            }
            .subject-tag {
                font-size: 0.8rem;
                padding: 6px 15px;
            }
            .options-grid {
                grid-template-columns: 1fr; /* Stack options on small screens */
            }
            .option-card {
                padding: 15px 20px;
                font-size: 0.95rem;
            }
            .option-prefix {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }
            .question-controls {
                flex-direction: column;
                gap: 15px;
            }
            .question-controls .btn {
                width: 100%;
                font-size: 0.95rem;
            }
            body.show-result .quiz-question-area {
                padding: 30px;
                margin: 15px auto; /* Adjust margin for mobile result */
            }
            .result-content-wrapper h2 {
                font-size: 2rem;
            }
            .stat-card-value {
                font-size: 2rem;
            }
            .result-action-buttons .btn {
                width: 100%;
                font-size: 1rem;
            }
            .question-lists li {
                flex-direction: column; /* Stack content and button */
                align-items: flex-start; /* Align content to left */
                gap: 8px; /* Space between stacked items */
                padding: 10px; /* Adjust padding for mobile list items */
            }
            .question-lists li .list-item-content {
                width: 100%; /* Content takes full width */
                margin-right: 0; /* Remove right margin */
                margin-bottom: 5px; /* Space below content */
            }
            .btn-view-now {
                width: 100%; /* Make button full width */
                text-align: center;
                padding: 10px; /* Adjust padding */
            }
        }

        @media (max-width: 767px) { /* Changed from 768px to 767px for Bootstrap's common breakpoint */
            .navbar {
                flex-direction: column;
                text-align: center;
            }
            .question-nav-panel {
                display: none; /* Default to hidden for mobile, controlled by JS class toggle */
                position: fixed;
                top: 0;
                right: 0;
                bottom: 0;
                width: 80%; /* Takes up most of the screen */
                z-index: 2000;
                box-shadow: -8px 0 30px var(--shadow-dark);
                animation: slideIn 0.3s forwards;
            }
            #toggle-nav-btn { /* This button will show on mobile to toggle the nav panel */
                display: block; /* Show this button on small screens */
                width: 100%;
                background-color: var(--accent-purple);
                color: white;
                padding: 12px;
                border-radius: 8px;
                font-weight: 600;
                margin-top: 10px;
                border: none;
                transition: background-color 0.2s ease;
            }
            #toggle-nav-btn:hover {
                background-color: #7a46d1;
            }
            /* When the nav panel is shown on small screens */
            body.show-nav-panel .question-nav-panel {
                display: flex !important; /* This will be the primary controller for visibility */
            }
            body.show-nav-panel .overlay {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0,0,0,0.6);
                z-index: 1999;
            }
            .close-nav-btn {
                display: block;
                background: none;
                border: none;
                color: var(--text-light);
                font-size: 1.5rem;
                position: absolute;
                top: 15px;
                right: 15px;
                z-index: 2001;
            }
        }
    </style>
</head>
<body>

    <div class="overlay" onclick="toggleNavPanel()"></div>

    <nav class="navbar sticky-top">
        <div class="container-fluid px-3 d-flex justify-content-between align-items-center">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-graduation-cap me-2"></i>Board Objective Test 01
            </a>
            <div class="d-flex align-items-center navbar-buttons">
                <div class="timer-display me-2 fw-bold" id="timer">
                    <i class="far fa-clock me-1"></i><span id="timer-display">1:00:00</span>
                </div>
                <!-- Dark mode button removed from here -->
                <button class="btn btn-submit-quiz-navbar" onclick="confirmAndSubmitQuiz()">
                    <i class="fas fa-paper-plane me-1"></i> Submit
                </button>
            </div>
        </div>
    </nav>

    <button id="toggle-nav-btn" class="d-md-none" onclick="toggleNavPanel()">
        <i class="fas fa-bars me-2"></i> Show Question Navigator
    </button>

    <div class="main-wrapper">
        <div class="quiz-question-area" id="quiz-container">
            <div id="quiz-box"></div>
        </div>

        <div class="question-nav-panel" id="question-nav-panel">
            <button class="close-nav-btn d-md-none" onclick="toggleNavPanel()">
                <i class="fas fa-times"></i>
            </button>
            <div class="panel-heading">Question Navigator</div>
            
            <div class="panel-section">
                <div class="panel-section-title" onclick="toggleSection('Maths')">
                    <span>📘 Maths</span> <i class="fas fa-chevron-down"></i>
                </div>
                <div class="nav-buttons-grid" id="Maths-nav"></div>
            </div>
            
            <div class="panel-section">
                <div class="panel-section-title" onclick="toggleSection('SST')">
                    <span>🧪 SST</span> <i class="fas fa-chevron-down"></i>
                </div>
                <div class="nav-buttons-grid" id="SST-nav"></div>
            </div>
            
           
        </div>
    </div>

    <!-- Custom Modal for Alerts (replacing window.alert/confirm) -->
    <div id="custom-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
        <div style="background: var(--bg-secondary); padding: 30px; border-radius: 15px; max-width: 400px; text-align: center; box-shadow: 0 8px 25px var(--shadow-dark); border: 1px solid var(--border-color);">
            <p id="modal-message" style="font-size: 1.1rem; color: var(--text-light); margin-bottom: 25px;"></p>
            <button id="modal-ok-btn" class="btn btn-primary me-2" style="background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); border: none; padding: 10px 20px; border-radius: 20px;">OK</button>
            <button id="modal-cancel-btn" class="btn btn-secondary" style="background-color: var(--border-color); border: none; padding: 10px 20px; border-radius: 20px; color: var(--text-light);"></button>
        </div>
    </div>

    <button id="back-to-result-btn" onclick="showResult()">
        🔙 Back to Result
    </button>

    <!-- Dark Mode Toggle Button - New Position -->
    <button id="theme-toggle-btn" onclick="toggleDarkMode()">
        <!-- Initial icon will be set by JS on page load -->
    </button>

    <!-- IMPORTANT: Make sure your kj.js file is loaded BEFORE this script tag. -->
    <!-- Example: <script src="kj.js"></script> -->
    <script src="kj.js"></script>

    <script>
        // --- Global Variables (assuming 'questions' array is loaded from kj.js) ---
        let current = 0;
        let answers = {};
        let markedForReview = {}; // Store question IDs marked for review
        let timerInterval;
        const totalTime = 1 * 60 * 60; // 3 hours in seconds (3:00:00)

        let currentMode = "quiz"; // Possible values: "quiz", "result", "review"

        // --- DOM Element References ---
        const quizBox = document.getElementById("quiz-box");
        const timerDisplayElement = document.getElementById("timer-display");
        const MathsNav = document.getElementById("Maths-nav");
        const SSTNav = document.getElementById("SST-nav");
        const mathsNav = document.getElementById("maths-nav");
        const questionNavPanel = document.getElementById("question-nav-panel");
        const toggleNavBtn = document.getElementById("toggle-nav-btn");
        const backToResultBtn = document.getElementById("back-to-result-btn");
        const body = document.body;
        const customModal = document.getElementById('custom-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalOkBtn = document.getElementById('modal-ok-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const themeToggleBtn = document.getElementById('theme-toggle-btn'); // Get reference to the new dark mode button


        // This object will store the state of each question in the navigation bar
        // Possible values: 'attempted', 'marked-review', 'skipped', 'correct-answered', 'incorrect-answered'
        // Default is no class (unattempted/unseen initially)
        let questionNavStates = {};

        // --- Custom Modal Function (replaces alert/confirm) ---
        function showCustomModal(message, type = 'alert', onConfirm = null) {
            modalMessage.innerHTML = message;
            modalOkBtn.textContent = 'OK'; 
            modalCancelBtn.style.display = 'none'; // Hide cancel by default

            if (type === 'confirm') {
                modalOkBtn.textContent = 'Yes';
                modalCancelBtn.textContent = 'No';
                modalCancelBtn.style.display = 'inline-block';
                modalOkBtn.onclick = () => {
                    customModal.style.display = 'none';
                    if (onConfirm) onConfirm(true);
                };
                modalCancelBtn.onclick = () => {
                    customModal.style.display = 'none';
                    if (onConfirm) onConfirm(false);
                };
            } else { // alert type
                modalOkBtn.onclick = () => {
                    customModal.style.display = 'none';
                    if (onConfirm) onConfirm(); // Call callback even for alert if provided
                };
            }
            customModal.style.display = 'flex'; // Show modal
        }


        // --- Helper Functions ---

        // Function to update the navigation button state
        function updateNavButtonState(questionId, state) {
            const navButton = document.querySelector(`.nav-button[data-qid="${questionId}"]`);
            if (navButton) {
                // Remove previous state classes
                navButton.classList.remove("attempted", "marked-review", "current", "correct-answered", "incorrect-answered", "skipped");
                // Add new state class
                if (state) {
                    navButton.classList.add(state);
                }
                // Update our internal tracking object
                questionNavStates[questionId] = state;
            }
        }

        // Function to render a single question
        window.loadQuestion = function(index) {
            // Check if questions array exists and is populated
            if (!questions || questions.length === 0 || !questions[index]) {
                quizBox.innerHTML = "<p>Error: Questions data not loaded or index out of bounds. Please check the `questions` array in your `kj.js` file.</p>"; 
                console.error("Questions array is empty or index is invalid:", questions, index);
                return;
            }

            current = index;
            const q = questions[current];
            const isReview = currentMode === "review";

            let questionHtml = `
                <div class="question-header">
                    <div class="question-number">Question ${current + 1} of ${questions.length}</div>
                    <div class="subject-info">
                        <span class="subject-tag">${q.subject}</span>
                        <span class="mark-pill plus">+${q.marks ? q.marks.positive : 4}</span>
                        <span class="mark-pill minus">-${q.marks ? q.marks.negative : 1}</span>
                    </div>
                </div>
                <p class="question-text h4 mb-4">${q.question || ''}</p>
            `;

            if (q.image) {
                questionHtml += `
                    <div class="question-image-container">
                        <img src="${q.image}" alt="Question Image" onerror="this.onerror=null;this.src='https://placehold.co/400x200/5A6270/E2E8F0?text=Image+Not+Found';">
                    </div>
                `;
            }

            if (q.type === "mcq") {
                questionHtml += '<div class="options-grid">';
                q.options.forEach((opt, idx) => {
                    const optionPrefix = String.fromCharCode(65 + idx);
                    let selectedClass = (answers[q.id] === opt) ? "selected" : "";
                    let reviewClass = "";
                    let disabledAttr = isReview ? "disabled" : "";

                    if (isReview) {
                        // Use q.correct for checking the correct answer
                        if (opt === q.correct) { 
                            reviewClass = "correct"; // Correct answer
                        } else if (answers[q.id] === opt && answers[q.id] !== q.correct) { 
                            reviewClass = "incorrect"; // User selected this but it's wrong
                        }
                    }

                    questionHtml += `
                        <div class="option-card ${selectedClass} ${reviewClass}"
                             data-option="${opt}"
                             onclick="${isReview ? '' : `selectOption('${q.id}', '${opt}')`}"
                             ${disabledAttr}>
                            <div class="option-prefix">${optionPrefix}</div>
                            <div class="option-text">${opt}</div>
                        </div>
                    `;
                });
                questionHtml += '</div>'; // close options-grid
            } else if (q.type === "integer") {
                const userAnswer = answers[q.id] || "";
                questionHtml += `
                    <div class="integer-input-box mb-4">
                        <label for="int-ans">Enter your answer (integer only):</label>
                        <input type="number" id="int-ans" class="form-control"
                               value="${userAnswer}"
                               oninput="${isReview ? '' : `setIntegerAnswer(this.value)`}"
                               ${isReview ? 'disabled' : ''}
                               placeholder="Type your answer here">
                    </div>
                `;
                if (isReview) {
                    // Use q.correct for checking the correct answer
                    const isCorrect = parseInt(userAnswer) === parseInt(q.correct); // Ensure comparison is numeric
                    const userAnswerClass = isCorrect ? "correct-answer" : "incorrect-answer";
                    questionHtml += `
                        <div class="integer-review-box">
                            <p>Your Answer: <strong class="user-answer ${userAnswerClass}">${userAnswer !== "" ? userAnswer : "N/A"}</strong></p>
                            <p>Correct Answer: <strong>${q.correct}</strong></p>
                        </div>
                    `;
                }
            }

            if (!isReview) { // Only show controls in quiz mode
                questionHtml += `
                    <div class="question-controls">
                        <button class="btn btn-clear-response" onclick="clearResponse('${q.id}', '${q.type}')">
                            <i class="fas fa-eraser me-2"></i> Clear Response
                        </button>
                        <button class="btn btn-secondary" onclick="skipQuestion('${q.id}')">
                            <i class="fas fa-forward me-2"></i> Skip
                        </button>
                        <button class="btn btn-mark-review-next" onclick="markForReviewAndNext('${q.id}')">
                            <i class="fas fa-bookmark me-2"></i> Mark for Review & Next
                        </button>
                        <button class="btn btn-save-next" onclick="saveAndNext()">
                            <i class="fas fa-arrow-right me-2"></i> Save & Next
                        </button>
                    </div>
                `;
            } else { // Navigation buttons for review mode
                questionHtml += `
                    <div class="question-controls review-nav-buttons">
                        <button class="btn btn-primary" onclick="loadQuestion(${current - 1})" ${current === 0 ? 'disabled' : ''}>
                            <i class="fas fa-chevron-left me-2"></i> Previous
                        </button>
                        <button class="btn btn-primary" onclick="loadQuestion(${current + 1})" ${current === questions.length - 1 ? 'disabled' : ''}>
                            Next <i class="fas fa-chevron-right ms-2"></i>
                        </button>
                    </div>
                `;
            }

            quizBox.innerHTML = questionHtml;
            updateNavButtonsDisplay(); // Re-render nav buttons to reflect current question
        };

        // Function to handle MCQ option selection
        window.selectOption = function(qid, selectedOption) {
            if (currentMode === "review") return;
            answers[qid] = selectedOption;
            // Visually update selected option
            const options = document.querySelectorAll('.option-card');
            options.forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.option === selectedOption) {
                    opt.classList.add('selected');
                }
            });
            updateNavButtonState(qid, "attempted"); // Mark as attempted immediately
        };

        // Function for integer input
        window.setIntegerAnswer = function(value) {
            if (currentMode === "review") return;
            const qid = questions[current].id;
            answers[qid] = value.trim(); // Store as string, can parse later for calculation
            updateNavButtonState(qid, "attempted"); // Mark as attempted
        };

        // Function to clear the current question's response
        window.clearResponse = function(qid, type) {
            delete answers[qid]; // Remove the answer for this question
            delete markedForReview[qid]; // Also unmark for review if it was
            updateNavButtonState(qid, "skipped"); // Change state to skipped

            if (type === "mcq") {
                document.querySelectorAll(".option-card").forEach(card => card.classList.remove("selected"));
            } else if (type === "integer") {
                const input = document.getElementById("int-ans");
                if (input) input.value = "";
            }
        };

        // Function to skip the current question and move to the next
        window.skipQuestion = function(qid) {
            if (currentMode === "review") return;
            // Clear any existing answer for this question
            delete answers[qid];
            // Remove from marked for review if it was
            delete markedForReview[qid];
            // Update the navigation button state to skipped
            updateNavButtonState(qid, "skipped");
            
            // Move to the next question
            if (current < questions.length - 1) {
                loadQuestion(current + 1);
            } else {
                showCustomModal("You have reached the end of the question list. Please submit your quiz.", 'alert'); 
            }
        };

        // Function to save current answer and load next question
        window.saveAndNext = function() {
            const qid = questions[current].id;
            // Check if an answer exists for the current question
            if (answers[qid] !== undefined && answers[qid] !== "") {
                // If it was marked for review, keep that state, otherwise set to attempted
                if (!markedForReview[qid]) {
                    updateNavButtonState(qid, "attempted");
                }
            } else {
                // If no answer, ensure it's not marked as attempted
                if (!markedForReview[qid]) { // Only if not already marked for review
                    updateNavButtonState(qid, "skipped");
                }
            }

            if (current < questions.length - 1) {
                loadQuestion(current + 1);
            } else {
                showCustomModal("You have reached the end of the question list! This question is marked for review. Please submit your quiz.", 'alert'); 
            }
        };

        // Function to mark for review and go to next question
        window.markForReviewAndNext = function(qid) {
            markedForReview[qid] = true;
            updateNavButtonState(qid, "marked-review");
            if (current < questions.length - 1) {
                loadQuestion(current + 1);
            } else {
                showCustomModal("You have reached the end of the question list! This question is marked for review. Please submit your quiz.", 'alert'); 
            }
        };

        // Function to start the timer
        window.startTimer = function() {
            let timeLeft = totalTime;

            timerInterval = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    confirmAndSubmitQuiz(); // Auto-submit when time runs out
                    return;
                }

                const hours = Math.floor(timeLeft / 3600);
                const minutes = Math.floor((timeLeft % 3600) / 60);
                const seconds = timeLeft % 60;

                timerDisplayElement.textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                timeLeft--;
            }, 1000);
        };

        // Function to generate the navigation buttons for a subject section
        function generateNavButtons(container, subjectQuestions) {
            container.innerHTML = ''; // Clear existing buttons
            subjectQuestions.forEach((q) => {
                const globalIndex = questions.findIndex(item => item.id === q.id); // Get global index based on original ID
                const button = document.createElement("button");
                button.classList.add("nav-button");
                button.dataset.qid = q.id;
                button.textContent = globalIndex + 1; // Display 1-based index

                // Apply current state if available
                const stateClass = questionNavStates[q.id];
                if (stateClass) {
                    button.classList.add(stateClass);
                }

                // Highlight the current question
                if (globalIndex === current) {
                    button.classList.add("current");
                }

                button.onclick = () => loadQuestion(globalIndex);
                container.appendChild(button);
            });
        }

        // Function to update the active state of navigation buttons
        function updateNavButtonsDisplay() {
            // Check if questions array is loaded before proceeding
            if (!questions || questions.length === 0) {
                console.warn("Questions array is not loaded. Cannot update navigation buttons.");
                return;
            }

            // Remove 'current' from all buttons first
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('current');
            });
            const currentQuestionId = questions[current].id;
            const currentNavButton = document.querySelector(`.nav-button[data-qid="${currentQuestionId}"]`);
            if (currentNavButton) {
                currentNavButton.classList.add('current'); // Add 'current' to the active one
            }

            // Re-generate/update all nav buttons to ensure states are correct
            const MathsQuestions = questions.filter(q => q.subject === 'Maths');
            const SSTQuestions = questions.filter(q => q.subject === 'SST');
            const mathsQuestions = questions.filter(q => q.subject === 'Maths');
            // Assuming 'Mixed' subject is also possible, if not defined in kj.js, this filter will be empty
            const mixedQuestions = questions.filter(q => q.subject === 'Mixed'); 

            // Ensure all relevant navigation sections are updated
            if (MathsNav) generateNavButtons(MathsNav, MathsQuestions);
            if (SSTNav) generateNavButtons(SSTNav, SSTQuestions);
            if (mathsNav) generateNavButtons(mathsNav, mathsQuestions);
            // If you have a dedicated Mixed section in HTML, you might add it here
            // e.g., if (mixedNav) generateNavButtons(mixedNav, mixedQuestions);
        }

        // Function to initialize the quiz
        window.initializeQuiz = function() {
            currentMode = "quiz";
            answers = {};
            markedForReview = {};
            questionNavStates = {}; // Clear nav button states for a fresh start
            body.classList.remove("show-result", "show-review", "show-nav-panel"); // Reset all body classes
            quizBox.style.display = "block";
            backToResultBtn.style.display = "none";
            timerDisplayElement.textContent = "1:00:00"; // Reset timer display

            // Initialize nav panel visibility based on screen size
            if (window.innerWidth >= 992) { // Desktop
                questionNavPanel.style.display = "flex"; // Ensure visible on desktop
                toggleNavBtn.style.display = 'none'; // Hide mobile toggle
            } else { // Tablet/Mobile
                body.classList.remove("show-nav-panel"); // Ensure mobile panel is not active
                questionNavPanel.style.display = "none"; // Explicitly hide nav panel initially on mobile
                toggleNavBtn.style.display = 'block'; // Show mobile toggle button
            }

            // Hide all nav button grids by default
            document.querySelectorAll('.nav-buttons-grid').forEach(grid => {
                grid.classList.remove('d-block');
                const chevron = grid.previousElementSibling.querySelector('.fa-chevron-down, .fa-chevron-up');
                if (chevron) {
                    chevron.classList.remove('fa-chevron-up');
                    chevron.classList.add('fa-chevron-down');
                }
            });

            // Check if 'questions' array is available globally before starting the quiz
            if (typeof questions !== 'undefined' && questions && questions.length > 0) {
                startTimer();
                loadQuestion(0); // Load the first question
            } else {
                quizBox.innerHTML = "<p>Error: Questions data not found. Please ensure your `kj.js` file is loaded correctly and defines a global `questions` array.</p>"; 
                console.error("Questions array is empty or undefined! Please check kj.js.");
            }
        };

        // Function to submit the quiz and show results
        window.submitQuiz = function() {
            clearInterval(timerInterval); // Stop the timer
            currentMode = "result";
            body.classList.add("show-result");
            body.classList.remove("show-review", "show-nav-panel"); // Ensure review mode and overlay are off

            let correctCount = 0;
            let incorrectCount = 0;
            let skippedCount = 0;
            let totalScore = 0;
            let maxScore = 0;

            const sectionAnalysis = {
                "Maths": { totalQuestions: 0, correct: 0, incorrect: 0, skipped: 0, score: 0, max_marks: 0 },
                "SST": { totalQuestions: 0, correct: 0, incorrect: 0, skipped: 0, score: 0, max_marks: 0 },
                "Maths": { totalQuestions: 0, correct: 0, incorrect: 0, skipped: 0, score: 0, max_marks: 0 },
                "Mixed": { totalQuestions: 0, correct: 0, incorrect: 0, skipped: 0, score: 0, max_marks: 0 } 
            };

            const correctQuestionsList = [];
            const incorrectQuestionsList = [];
            const unattemptedQuestionsList = [];

            questions.forEach(q => {
                const userAnswer = answers[q.id];
                const subject = q.subject;
                const positiveMarks = q.marks ? q.marks.positive : 4;
                const negativeMarks = q.marks ? q.marks.negative : 1;
                
                // Initialize subject in sectionAnalysis if it's new
                if (!sectionAnalysis[subject]) {
                     sectionAnalysis[subject] = { totalQuestions: 0, correct: 0, incorrect: 0, skipped: 0, score: 0, max_marks: 0 };
                }

                sectionAnalysis[subject].totalQuestions++;
                maxScore += positiveMarks;
                sectionAnalysis[subject].max_marks += positiveMarks;

                if (userAnswer === undefined || userAnswer === "") {
                    skippedCount++;
                    sectionAnalysis[subject].skipped++;
                    unattemptedQuestionsList.push({ id: q.id, number: questions.indexOf(q) + 1, question: q.question, subject: q.subject });
                    updateNavButtonState(q.id, "skipped"); // Update nav state for skipped
                } else {
                    let isCorrect = false;
                    // Use q.correct for comparison
                    if (q.type === "mcq") {
                        isCorrect = userAnswer === q.correct;
                    } else if (q.type === "integer") {
                        isCorrect = parseInt(userAnswer) === parseInt(q.correct); // Ensure comparison is numeric
                    }

                    if (isCorrect) {
                        correctCount++;
                        totalScore += positiveMarks;
                        sectionAnalysis[subject].correct++;
                        sectionAnalysis[subject].score += positiveMarks;
                        correctQuestionsList.push({ id: q.id, number: questions.indexOf(q) + 1, question: q.question, subject: q.subject });
                        updateNavButtonState(q.id, "correct-answered"); // Update nav state for correct
                    } else {
                        incorrectCount++;
                        totalScore -= negativeMarks; // Deduct negative marks
                        sectionAnalysis[subject].incorrect++;
                        sectionAnalysis[subject].score -= negativeMarks; // Add negative marks to score (subtraction)
                        incorrectQuestionsList.push({ id: q.id, number: questions.indexOf(q) + 1, question: q.question, subject: q.subject, userAnswer: userAnswer, correctAnswer: q.correct }); // Use q.correct
                        updateNavButtonState(q.id, "incorrect-answered"); // Update nav state for incorrect
                    }
                }
            });

            // Ensure totalScore doesn't go below 0
            if (totalScore < 0) {
                totalScore = 0;
            }

            const percentage = maxScore > 0 ? ((totalScore / maxScore) * 100).toFixed(2) : (0).toFixed(2);


            let sectionAnalysisTableHTML = `
                <h3 class="text-center mt-5 mb-4" style="color: var(--accent-blue);">Sectional Analysis</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Subject</th>
                            <th>Total Q's</th>
                            <th>Attempted</th>
                            <th>Correct</th>
                            <th>Incorrect</th>
                            <th>Skipped</th>
                            <th>Score</th>
                            <th>Max Marks</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            for (const subject in sectionAnalysis) {
                const data = sectionAnalysis[subject];
                const totalAttempted = data.correct + data.incorrect;
                sectionAnalysisTableHTML += `
                    <tr>
                        <td>${subject}</td>
                        <td>${data.totalQuestions}</td>
                        <td>${totalAttempted}</td>
                        <td class="text-success">${data.correct}</td>
                        <td class="text-danger">${data.incorrect}</td>
                        <td>${data.skipped}</td>
                        <td>${data.score}</td>
                        <td>${data.max_marks}</td>
                    </tr>
                `;
            }
            sectionAnalysisTableHTML += `</tbody></table>`;

            let resultHtml = `
                <div class="result-content-wrapper">
                    <h2>🎉 Quiz Completed! 🎉</h2>
                    <p class="lead text-center text-muted">Here are your results:</p>

                    <div class="result-stats-grid">
                        <div class="stat-card correct">
                            <div class="stat-card-title">Correct Answers</div>
                            <div class="stat-card-value">${correctCount}</div>
                        </div>
                        <div class="stat-card incorrect">
                            <div class="stat-card-title">Incorrect Answers</div>
                            <div class="stat-card-value">${incorrectCount}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-title">Skipped Questions</div>
                            <div class="stat-card-value">${skippedCount}</div>
                        </div>
                        <div class="stat-card score">
                            <div class="stat-card-title">Your Score</div>
                            <div class="stat-card-value">${totalScore} / ${maxScore}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-title">Percentage</div>
                            <div class="stat-card-value">${percentage}%</div>
                        </div>
                    </div>
                    ${sectionAnalysisTableHTML}

                    <div class="result-action-buttons">
                        <button class="btn btn-analyse" onclick="startReviewMode()">
                            <i class="fas fa-eye me-2"></i> Review Answers
                        </button>
                        <button class="btn btn-retake" onclick="retakeQuiz()">
                            <i class="fas fa-redo me-2"></i> Retake Quiz
                        </button>
                    </div>

                    <!-- Question Lists for Review -->
                    <div class="question-lists">
                        <h4><i class="fas fa-check-circle icon" style="color: var(--success);"></i> Correctly Answered Questions</h4>
                        <ul id="correct-questions-list"></ul>
                        <h4><i class="fas fa-times-circle icon" style="color: var(--danger);"></i> Incorrectly Answered Questions</h4>
                        <ul id="incorrect-questions-list"></ul>
                        <h4><i class="fas fa-question-circle icon" style="color: var(--text-muted);"></i> Unattempted Questions</h4>
                        <ul id="unattempted-questions-list"></ul>
                    </div>
                </div>
            `;

            quizBox.innerHTML = resultHtml;
            populateQuestionLists(correctQuestionsList, incorrectQuestionsList, unattemptedQuestionsList);
        };

        // Function to confirm quiz submission
        window.confirmAndSubmitQuiz = function() {
showCustomModal("Do you want to submit the quiz? You won't be able to change your answers after submission.", 'confirm', (confirmed) => {
                if (confirmed) {
                    submitQuiz();
                }
            });
        };

        // Populate lists for correct, incorrect, unattempted questions
        function populateQuestionLists(correctList, incorrectList, unattemptedList) {
            const correctListElement = document.getElementById('correct-questions-list');
            const incorrectListElement = document.getElementById('incorrect-questions-list');
            const unattemptedListElement = document.getElementById('unattempted-questions-list');

            if (!correctListElement || !incorrectListElement || !unattemptedListElement) {
                console.error("Result list elements not found.");
                return;
            }

            correctListElement.innerHTML = '';
            incorrectListElement.innerHTML = '';
            unattemptedListElement.innerHTML = '';

            // Helper to create list items with View Now button
            const createListItem = (q, statusClass, iconHtml) => {
                const listItem = document.createElement('li');
                listItem.classList.add(statusClass);
                // Use q.question or a placeholder if not defined
                const qDisplay = q.question || `Generic Question ${q.number}`;
                listItem.innerHTML = `
                    <div class="list-item-content">
                        <span class="icon">${iconHtml}</span> 
                        Question <strong>${q.number}</strong> (${q.subject}): ${qDisplay.substring(0, 70)}...
                    </div>
                    <button class="btn btn-view-now" onclick="reviewQuestionByUUID('${q.id}')">
                        View Now <i class="fas fa-arrow-right ms-1"></i>
                    </button>
                `;
                return listItem;
            };
if (correctList.length === 0) {
    correctListElement.innerHTML = '<li>No questions were answered correctly.</li>';
}
correctList.forEach(q => {
    correctListElement.appendChild(createListItem(q, 'correct-item', '<i class="fas fa-check"></i>'));
});

if (incorrectList.length === 0) {
    incorrectListElement.innerHTML = '<li>No questions were answered incorrectly.</li>';
}
incorrectList.forEach(q => {
    incorrectListElement.appendChild(createListItem(q, 'incorrect-item', '<i class="fas fa-times"></i>'));
});

if (unattemptedList.length === 0) {
    unattemptedListElement.innerHTML = '<li>All questions were attempted.</li>';
}
unattemptedList.forEach(q => {
    unattemptedListElement.appendChild(createListItem(q, 'unattempted-item', '<i class="fas fa-question"></i>'));
});
        }

        // Function to start review mode and optionally load a specific question
        window.startReviewMode = function(targetQuestionId = null) {
            currentMode = "review";
            body.classList.add("show-review");
            body.classList.remove("show-result");
            backToResultBtn.style.display = 'block'; // Show the "Back to Result" button
            
            // For desktop, ensure the nav panel is shown in review mode
            if (window.innerWidth >= 992) {
                questionNavPanel.style.display = "flex"; // Ensure flex for review mode
                toggleNavBtn.style.display = 'none'; // Hide mobile toggle
            } else {
                 toggleNavPanel(true); // Force open nav panel on mobile
            }
            
            // Expand all sections in review mode
            document.querySelectorAll('.nav-buttons-grid').forEach(grid => {
                grid.classList.add('d-block');
                const chevron = grid.previousElementSibling.querySelector('.fa-chevron-down, .fa-chevron-up');
                if (chevron) {
                    chevron.classList.remove('fa-chevron-down');
                    chevron.classList.add('fa-chevron-up');
                }
            });

            let indexToLoad = 0;
            if (targetQuestionId !== null) {
                // Ensure comparison is consistent (assuming q.id in kj.js is a string)
                const foundIndex = questions.findIndex(q => String(q.id) === String(targetQuestionId));
                if (foundIndex !== -1) {
                    indexToLoad = foundIndex;
                } else {
                    console.error("Target question not found for review:", targetQuestionId);
                }
            }
            loadQuestion(indexToLoad); // Load the specified question or the first one
        };

        // Function to review a specific question by its UUID (delegates to startReviewMode)
        window.reviewQuestionByUUID = function(questionId) {
            startReviewMode(questionId); 
        };


        // Function to go back to the result page from review mode
        window.showResult = function() {
            currentMode = "result";
            body.classList.remove("show-review");
            body.classList.add("show-result");
            backToResultBtn.style.display = 'none'; // Hide the "Back to Result" button
            submitQuiz(); // Re-render the result page (it will call `submitQuiz` which handles the rendering)
        };

        // Function to retake the quiz (resets everything)
        window.retakeQuiz = function() {
            showCustomModal("क्या आप क्विज़ फिर से लेना चाहते हैं? आपके सभी वर्तमान उत्तर खो जाएंगे.", 'confirm', (confirmed) => {
                if (confirmed) {
                    clearInterval(timerInterval);
                    current = 0;
                    answers = {};
                    markedForReview = {};
                    questionNavStates = {}; // Clear nav button states
                    currentMode = "quiz";
                    body.classList.remove("show-result", "show-review");
                    backToResultBtn.style.display = 'none';
                    timerDisplayElement.textContent = "1:00:00"; // Reset timer display
                    initializeQuiz(); // Start quiz fresh
                }
            });
        };

        // Function to toggle the navigation panel visibility
        // `forceState` parameter: true to force show, false to force hide, undefined to toggle
        window.toggleNavPanel = function(forceState = undefined) {
            const isMobile = window.innerWidth < 992;
            
            if (isMobile) {
                // If forceState is true, add class. If false, remove. If undefined, toggle.
                if (forceState === true) {
                    body.classList.add('show-nav-panel');
                } else if (forceState === false) {
                    body.classList.remove('show-nav-panel');
                } else {
                    body.classList.toggle('show-nav-panel');
                }

                // Update visibility of the toggle button based on class
                const isPanelVisible = body.classList.contains('show-nav-panel');
                toggleNavBtn.style.display = isPanelVisible ? 'none' : 'block';
                // The actual display of questionNavPanel is now handled purely by CSS due to 'show-nav-panel' class.
                // We don't need to manually set questionNavPanel.style.display anymore for mobile toggling.
            } else {
                // Desktop behavior: always show panel, hide mobile toggle
                questionNavPanel.style.display = "flex"; // Desktop always shows it directly
                toggleNavBtn.style.display = 'none';
                body.classList.remove('show-nav-panel'); // Ensure mobile overlay is off
            }
        };


        // Function to toggle sections in the nav panel (e.g., Maths, SST)
        window.toggleSection = function(sectionId) {
            const container = document.getElementById(`${sectionId}-nav`);
            const icon = container.previousElementSibling.querySelector('.fa-chevron-down, .fa-chevron-up');
            if (container) {
                container.classList.toggle('d-block'); // Toggle display with d-block
                // Toggle chevron icon
                if (container.classList.contains('d-block')) {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                } else {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            }
        };

        // Function to toggle Dark/Light Mode
        window.toggleDarkMode = function() {
            body.classList.toggle("light-mode"); // Toggle a class for light mode specific styles
            
            // Update the icon/text of the theme toggle button
            if (body.classList.contains('light-mode')) {
                themeToggleBtn.innerHTML = '🌙'; // Show moon icon to switch back to dark
            } else {
                themeToggleBtn.innerHTML = '☀️'; // Show sun icon to switch to light
            }
        };

        // --- Initial Setup and Event Listeners ---
        window.addEventListener("DOMContentLoaded", function() {
            console.warn("If you reload or leave this page during the quiz, all quiz data will be erased and quiz will start from scratch!"); 

            // Initialize theme based on user preference or default to dark
            const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
            if (prefersDarkScheme.matches) {
                // If user prefers dark, by default the :root vars apply dark mode.
                // Button should show "Light Mode" (moon icon) to toggle to it.
                themeToggleBtn.innerHTML = '☀️'; 
            } else {
                // If user prefers light, add 'light-mode' class to body.
                body.classList.add("light-mode");
                // Button should show "Dark Mode" (sun icon) to toggle to it.
                themeToggleBtn.innerHTML = '🌙'; 
            }

            initializeQuiz();
        });

        // Event listener for window resize to adjust panel visibility
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 992) { // Desktop
                questionNavPanel.style.display = "flex"; // Ensure visible on desktop
                toggleNavBtn.style.display = 'none'; // Hide mobile toggle button
                body.classList.remove('show-nav-panel'); // Remove mobile overlay class
            } else { // Tablet/Mobile
                // If it transitions from desktop to mobile, ensure panel is hidden unless explicitly opened
                if (!body.classList.contains("show-nav-panel")) { // Only change if not currently open via the mobile toggle
                    questionNavPanel.style.display = 'none';
                    toggleNavBtn.style.display = 'block'; // Show mobile toggle
                }
            }
        });
          // Alert on reload/refresh
window.onbeforeunload = function(e) {
    if (currentMode === "quiz") {
        return 'All quiz data will be erased and quiz will start from scratch. Are you sure to reload/exit?';
    }
};
// Alert as soon as page is loaded
window.addEventListener("DOMContentLoaded", function() {
    alert("If you reload or leave this page, all quiz data will be erased and quiz will start from scratch!");
});
    </script>
</body>
</html>
